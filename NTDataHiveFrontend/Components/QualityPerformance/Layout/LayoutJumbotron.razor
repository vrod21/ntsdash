@using System.ComponentModel.DataAnnotations
@using System.Text
@using System.Text.Encodings.Web
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Http.Extensions;
@using Microsoft.AspNetCore.Identity
@using NTDataHiveFrontend.Components.Account
@using NTDataHiveFrontend.Data

@using System.Security.Claims
@using Microsoft.AspNetCore.Components.Authorization

@attribute [Authorize]
@inject NTDataHiveFrontend.ServiceAccess.PersonNotExistBackendService MyPersonNotExistBackendService
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject IdentityUserAccessor UserAccessor
@inject UserManager<ApplicationUser> UserManager

@if (personRecord == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <EditForm Model="personRecord">
        <div class="jumbotron" style="text-align:center;">
            <img src="/images/greatplacetowork.png" style="width: 650px;" />
            <hr class="my-3">

            <RadzenRow class="rz-text-align-center" Gap="1rem">
                <RadzenColumn class="rz-p-5">
                    <h4>Your Credentials</h4>
                    <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-black" Text="@($"Email: {personRecord.EmailAddress}")" />
                    <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-black" Text="@($"Usename: {personRecord.Username}")" />

                    @if (personRecord.FirstName != "" && personRecord.LastName != "" && personRecord.Position != "" && personRecord.CompanyId != "")
                    {
                        <h1>John</h1>
                        <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-black" Text="@($"Usename: {personRecord.FirstName}")" />
                        <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-black" Text="@($"Usename: {personRecord.LastName}")" />
                        <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-black" Text="@($"Usename: {personRecord.Position}")" />
                        <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" class="rz-color-black" Text="@($"Usename: {personRecord.CompanyId}")" />
                    }                         
                </RadzenColumn>
                <RadzenColumn class="rz-background-color-info-lighter rz-color-on-info-lighter rz-p-5">
                    Column 2 of 4
                </RadzenColumn>
                <RadzenColumn class="rz-background-color-info-lighter rz-color-on-info-lighter rz-p-5">
                    Column 2 of 4
                </RadzenColumn>
                <RadzenColumn class="rz-background-color-info-lighter rz-color-on-info-lighter rz-p-5">
                    Column 4 of 4
                </RadzenColumn>
            </RadzenRow>
        </div>
    </EditForm>
}





@code {
    private string? userId;
    private Guid id { get; set; }
    private List<NTDataHiveFrontend.Model.Person> result = new List<Model.Person>();
    private NTDataHiveFrontend.Model.Person personRecord = new Model.Person();

    private AuthenticationState authState;

    protected override async Task OnInitializedAsync()
    {
        var auth = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var nameIdentifier = auth.User;

        userId = nameIdentifier.FindFirst(c => c.Type == ClaimTypes.NameIdentifier)?.Value;

        personRecord = await MyPersonNotExistBackendService.GetPersonRecord(userId);
    }

}
